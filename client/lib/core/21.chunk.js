/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{468:function(Ba,va,r){r.r(va);var oa=r(0),ka=r(10),la=r(2);Ba=r(48);var fa=r(34),ea=r(11);r=function(){function ca(){this.init()}ca.prototype.init=function(){this.K7=!1;this.Ue=this.ul=this.connection=null;this.hs={};this.fa=this.LF=null};ca.prototype.aoa=function(x){for(var y=this,h=0;h<x.length;++h){var e=x[h];switch(e.at){case "create":this.hs[e.author]||(this.hs[e.author]=e.aName);this.Nea(e);break;case "modify":this.fa.Zl(e.xfdf).then(function(b){y.fa.mb(b[0])});
break;case "delete":this.fa.Zl("<delete><id>"+e.aId+"</id></delete>")}}};ca.prototype.Nea=function(x){var y=this;this.fa.Zl(x.xfdf).then(function(h){h=h[0];h.authorId=x.author;y.fa.mb(h);y.fa.trigger(ka.b.UPDATE_ANNOTATION_PERMISSION,[h])})};ca.prototype.oea=function(x,y,h){this.ul&&this.ul(x,y,h)};ca.prototype.preloadAnnotations=function(x){this.addEventListener("webViewerServerAnnotationsEnabled",this.oea.bind(this,x,"add",{imported:!1}),{once:!0})};ca.prototype.initiateCollaboration=function(x,
y,h){var e=this;if(x){e.Ue=y;e.fa=h.na();h.addEventListener(ka.e.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.Boa(x);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var a=JSON.parse(b.responseText);e.connection=exports.Ra.hpa(Object(fa.j)(e.Ue,"blackbox/"),"annot");e.LF=a.id;e.hs[a.id]=a.user_name;e.fa.SM(a.id);e.connection.fsa(function(f){f.t&&f.t.startsWith("a_")&&f.data&&e.aoa(f.data)},function(){e.connection.send({t:"a_retrieve",
dId:x});e.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.hs[a.id],e.LF])},function(){e.disableCollaboration()})}catch(f){Object(la.g)(f.message)}});b.open("GET",Object(fa.j)(this.Ue,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();e.K7=!0;e.fa.DZ(function(a){return e.hs[a.Author]||a.Author})}else Object(la.g)("Document ID required for collaboration")};ca.prototype.disableCollaboration=function(){this.ul&&(this.fa.removeEventListener(ea.a.Events.ANNOTATION_CHANGED,this.ul),this.ul=
null);this.connection&&this.connection.Sp();this.fa&&this.fa.SM("Guest");this.init();this.trigger(ca.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ca.prototype.Boa=function(x){var y=this;this.ul&&this.fa.removeEventListener(ea.a.Events.ANNOTATION_CHANGED,this.ul);this.ul=function(h,e,b){return Object(oa.b)(this,void 0,void 0,function(){var a,f,n,z,w,da,ja,aa,ba;return Object(oa.d)(this,function(ia){switch(ia.label){case 0:if(b.imported)return[2];a={t:"a_"+e,dId:x,annots:[]};return[4,y.fa.YI()];case 1:f=
ia.da();"delete"!==e&&(n=(new DOMParser).parseFromString(f,"text/xml"),z=new XMLSerializer);for(w=0;w<h.length;w++)da=h[w],aa=ja=void 0,"add"===e?(ja=n.querySelector('[name="'+da.Id+'"]'),aa=z.serializeToString(ja),ba=null,da.InReplyTo&&(ba=y.fa.kf(da.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:da.Id,author:y.LF,aName:y.hs[y.LF],parent:ba,xfdf:"<add>"+aa+"</add>"})):"modify"===e?(ja=n.querySelector('[name="'+da.Id+'"]'),aa=z.serializeToString(ja),a.annots.push({at:"modify",aId:da.Id,
xfdf:"<modify>"+aa+"</modify>"})):"delete"===e&&a.annots.push({at:"delete",aId:da.Id});0<a.annots.length&&y.connection.send(a);return[2]}})})}.bind(y);this.fa.addEventListener(ea.a.Events.ANNOTATION_CHANGED,this.ul)};ca.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ca}();Object(Ba.a)(r);va["default"]=r}}]);}).call(this || window)
